!function(t){jQuery.fn.lastFmRecords=function(t){function e(t){return 1==t?"":"s"}var r={user:"hondjevandirkie",period:"recenttracks",imgwidth:80,count:6,stylesheet:!1,styletype:"",refreshmin:3,defaultthumb:!1,debug:!1,gmt_offset:"+1",linknewscreen:!1,LASTFM_APIKEY:"fbfa856cc3af93c43359b57921b1e64e",LASTFM_WS_URL:"http://ws.audioscrobbler.com/2.0/"},a=[],s=function(t){!1!==_settings.debug&&"0"!==_settings.debug&&"undefined"!=typeof console&&"function"==typeof console.log&&("object"==typeof t?console.log(t):console.log("last.fm.records: "+t))},i=function(){return!1},n=function(t){var e,r=!1;return jQuery.each(t,function(t,a){"error"==t&&(r=!0,e=" ("+a+")"),r&&"message"==t&&(e=a+e)}),r&&s("last.fm reported error: "+e),r},o=function(t,e){return _sizeFound=!1,_imgUrl="",jQuery.each(t,function(t,e){return"extralarge"==e.size?(_imgUrl=e["#text"],!1):void("large"==e.size?(_imgUrl=e["#text"],_sizeFound="large"):"medium"==e.size&&"large"!=_sizeFound?(_imgUrl=e["#text"],_sizeFound=e.size):"small"==e.size&&!1===_sizeFound&&(_imgUrl=e["#text"],_sizeFound=e.size))}),_imgUrl},d=function(t,r){var a=new Date-new Date(t);a-=6e4*r*60;var s={year:31536e6,day:864e5,hour:36e5,minute:6e4},i=[];jQuery.each(s,function(t,r){var s=parseInt(a/r);s>0&&(i.push(s+" "+t+e(s)),a-=s*r)});var n=i.pop()+" ago";return i.length>0&&(n=i.join(", ")+" and "+n),n},m=function(t,r){if(_settings=t.data("settings"),n(r))return!1;switch(_settings.period){case"recenttracks":r=r.recenttracks.track;break;case"lovedtracks":r=r.lovedtracks.track;break;case"toptracks":case"tracks7day":case"tracks3month":case"tracks6month":case"tracks12month":case"tracksoverall":r=r.toptracks.track;break;case"topalbums":case"topalbumsoverall":case"topalbums7day":case"topalbums3month":case"topalbums6month":case"topalbums12month":r=r.topalbums.album;break;case"topartists":case"topartistsoverall":case"topartists7day":case"topartists3month":case"topartists6month":case"topartists12month":r=r.topartists.artist;break;default:return s("Sorry, period '"+_settings.period+"' is unknown."),!1}return r?(r.name&&"string"==typeof r.name&&(r=[r]),s("last fm returned "+r.length+" records."),jQuery.each(r,function(e,r){if(e>_settings.count)return!1;var a=[];a.cdcover=r.image?o(r.image,_settings.LASTFM_DEFAULTIMG):!1,"topartists"==_settings.period.slice(0,10)?(a.artistname=r.name,a.artistmbid="",a.name=""):(a.artistname=r.artist["#text"]||r.artist.name,a.artistmbid=r.artist.mbid,a.name=r.name),a.mbid=r.mbid,a.url="http://"==r.url.substr(0,7).toLowerCase()?r.url:"http://"+r.url,"recenttracks"==_settings.period?r["@attr"]&&"true"==r["@attr"].nowplaying?a.time="listening now":a.time="undefined"==typeof r.date?"some time":d(r.date["#text"],_settings.gmt_offset):a.time="",c(e,a,t)}),void(_settings.refreshmin>0&&"recenttracks"==_settings.period&&(s("set timer to refresh covers in "+_settings.refreshmin+" minute"+e(_settings.refreshmin)+" for element "+t.attr("id")+"."),setTimeout(function(){l(t)},6e4*_settings.refreshmin)))):(s("No return data from Last.fm"),!1)},c=function(t,e,r){jQuery.each(e,function(e,a){jQuery("#lfr_"+r.attr("id")+"_"+t).data(e,a)});var n=e.artistname;if(""!=e.name)var n=e.name+" by "+n;""!=e.time&&(n+=" ("+e.time+")"),jQuery("#lfr_"+r.attr("id")+"_"+t).attr("title",n),""!=e.cdcover&&e.cdcover.length>0?jQuery("#lfr_"+r.attr("id")+"_"+t).attr("src",e.cdcover).parent("a").attr("href",e.url).unbind("click",i):"*"==a[e.artistmbid]||(a[e.artistmbid]?jQuery("#lfr_"+r.attr("id")+"_"+t).attr("src",a[e.artistmbid]).parent("a").attr("href",e.url).unbind("click",i):e.artistmbid?(s("cover for "+e.name+" not found, trying to find image of artist "+e.artistname),jQuery("#lfr_"+r.attr("id")+"_"+t).addClass(e.artistmbid),u(r,e.artistmbid)):s("no image found for track "+e.name))},l=function(t){_settings=t.data("settings");var e=!1;switch(_settings.period){case"lovedtracks":e="user.getlovedtracks";break;case"topalbums":case"topalbumsoverall":e="user.gettopalbums&period=overall";break;case"topalbums7day":e="user.gettopalbums&period=7day";break;case"topalbums3month":e="user.gettopalbums&period=3month";break;case"topalbums6month":e="user.gettopalbums&period=6month";break;case"topalbums12month":e="user.gettopalbums&period=12month";break;case"toptracks":e="user.gettoptracks";break;case"tracksoverall":e="user.gettoptracks&period=overall";break;case"tracks7day":e="user.gettoptracks&period=7day";break;case"tracks3month":e="user.gettoptracks&period=3month";break;case"tracks6month":e="user.gettoptracks&period=6month";break;case"tracks12month":e="user.gettoptracks&period=12month";break;case"recenttracks":e="user.getrecenttracks";break;case"topartists":case"topartistsoverall":e="user.gettopartists&period=overall";break;case"topartists7day":e="user.gettopartists&period=7day";break;case"topartists3month":e="user.gettopartists&period=3month";break;case"topartists6month":e="user.gettopartists&period=6month";break;case"topartists12month":e="user.gettopartists&period=12month"}return 0==e?(s("Sorry, period '"+_settings.period+"' is unknown."),!1):(_reqlastfmdata=_settings.LASTFM_WS_URL+"?method="+e+"&limit="+_settings.count+"&user="+_settings.user+"&api_key="+_settings.LASTFM_APIKEY+"&format=json&callback=?",s(_reqlastfmdata),void jQuery.getJSON(_reqlastfmdata,function(e){m(t,e)}))},u=function(t,e){a[e]="*",jQuery.getJSON(_settings.LASTFM_WS_URL+"?method=artist.getinfo&mbid="+e+"&api_key="+_settings.LASTFM_APIKEY+"&format=json&callback=?",function(e){p(t,e)})},p=function(t,e){return n(e)?!1:void jQuery.each(e,function(t,e){return _imgurl=o(e.image),_mbid=e.mbid,jQuery("."+_mbid).each(function(){jQuery(this).attr("src",_imgurl).removeClass(_mbid).parent("a").attr("href",e.url).unbind("click",i)}),a[_mbid]=_imgurl,!1})},g=function(t){_settings=t.data("settings"),s("adding temporary cd covers to div "+t.attr("id"));for(var e,r,a=jQuery("<ol></ol>").appendTo(t),n=0;n<_settings.count;n++)r=jQuery("<li></li>"),_a=jQuery("<a></a>").bind("click",i).attr("href","").appendTo(r),"highslide"==_settings.styletype?_a.click(function(){return hs.expand(this)}):"lightbox"==_settings.styletype&&_a.attr("rel","lightbox"),"1"==_settings.linknewscreen&&_a.attr("target","_blank"),e=jQuery("<img></img>").attr("src",_settings.defaultthumb).attr("id","lfr_"+t.attr("id")+"_"+n).on("error",function(){jQuery(this).attr("src",_settings.defaultthumb)}).appendTo(_a),r.appendTo(a)},h=function(t){_settings=t.data("settings"),_elemname="#"+t.attr("id"),_imgwidth=_settings.imgwidth,_minwidth=parseInt(_imgwidth)+48;var e="";switch(_settings.stylesheet){case"simple":e+=_elemname+" { padding: 0px; padding-bottom: 10px; } ",e+=_elemname+" ol, "+_elemname+" li { margin: 0; padding: 0; list-style: none; } ",e+=_elemname+' ol:after { content: ""; display: table; clear: both; } ',e+=_elemname+" li { float: left; margin: 0px 5px 5px 0px; } ",e+=_elemname+" a { display: block; float: left; width: "+_imgwidth+"px; height: "+_imgwidth+"px; line-height: "+_imgwidth+"px;overflow: hidden; position: relative; z-index: 1; } ",e+=_elemname+" a img { float: left; position: absolute; margin: auto; width: "+_imgwidth+"px; height: "+_imgwidth+"px; } ";break;case"hover":e+=_elemname+" { padding: 0px; padding-bottom: 10px; } ",e+=_elemname+" ol, "+_elemname+" li { margin: 0; padding: 0; list-style: none; } ",e+=_elemname+' ol:after { content: ""; display: table; clear: both; } ',e+=_elemname+" li { float: left; margin: 0px 5px 5px 0px; } ",e+=_elemname+" a { display: block; float: left; width: "+_imgwidth+"px; height: "+_imgwidth+"px; overflow: hidden; position: relative; z-index: 1; } ",e+=_elemname+" a img { float: left; position: absolute; margin: -24px 24px 24px -24px; padding: 3px; border: 1px solid #888; background-color: white; width: "+_minwidth+"px; height: "+_minwidth+"px; max-width: "+_minwidth+"px; }",e+=_elemname+" a:hover { overflow:visible; z-index:1000; } "}""!=e&&(s("adding css for element "+_elemname),jQuery('<style type="text/css">'+e+"</style>").appendTo(jQuery("head")))};return this.each(function(){$this=jQuery(this),_opts={},t&&(0==$this.attr("id").indexOf("lfr_shortcode")?(_shortcodenr=parseInt($this.attr("id").replace("lfr_shortcode","")),_opts=t.shortcode[_shortcodenr]):_opts=t.widget,jQuery.each(r,function(t,e){void 0===_opts[t]&&(_opts[t]=e)}),0==_opts.defaultthumb&&jQuery.each(jQuery("script"),function(){this.src.indexOf("last.fm.records.js")>=0&&(_opts.defaultthumb=this.src.substr(0,this.src.lastIndexOf("/")+1)+"defaultcover.png")})),$this.data("settings",_opts),h($this),g($this),l($this)})}}(jQuery);